{"componentChunkName":"component---src-templates-blog-js","path":"/blog/my-diy-smart-thermostat","result":{"data":{"markdownRemark":{"fields":{"slug":"my-diy-smart-thermostat"},"frontmatter":{"title":"My DIY Smart Thermostat","author":"Tom Rodrigues","date":"April 17th, 2020","hero_image":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAxNDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjL/wgARCAANABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAID/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAT/2gAMAwEAAhADEAAAAZhtbBiof//EABsQAAICAwEAAAAAAAAAAAAAAAECAAMEERMS/9oACAEBAAEFAvS7Ng10qiCOvSJiIR//xAAZEQABBQAAAAAAAAAAAAAAAAAAAwQREhP/2gAIAQMBAT8Bq3gwRP/EABgRAAIDAAAAAAAAAAAAAAAAAAARAwQT/9oACAECAQE/AXZZtMf/xAAdEAACAgEFAAAAAAAAAAAAAAAAEQEhMRIiQXGB/9oACAEBAAY/AqXo1q6MwRmjc5OT/8QAGxAAAgIDAQAAAAAAAAAAAAAAASEAETFBUXH/2gAIAQEAAT8hKBAPUQnasoN4TEBfFwIC9GHCRjRrM//aAAwDAQACAAMAAAAQoy//xAAdEQABAgcAAAAAAAAAAAAAAAAAAREhMUFxodHh/9oACAEDAQE/EJNo2XY9XHD/xAAdEQABAgcAAAAAAAAAAAAAAAAAAREhMXHB0eHw/9oACAECAQE/EJl4VTFzp9n/xAAcEAEBAQEAAgMAAAAAAAAAAAABESEAMWFBgbH/2gAIAQEAAT8Qg05iBnt4gBBsFffEIY8lX84iuxTVd1zfL15TFRLvwHSuxx5e29//2Q==","aspectRatio":1.4880952380952381,"src":"/static/2f08f7bf723cf42a6a79deabc50d8b18/398d8/hero.jpg","srcSet":"/static/2f08f7bf723cf42a6a79deabc50d8b18/8def4/hero.jpg 375w,\n/static/2f08f7bf723cf42a6a79deabc50d8b18/35c3d/hero.jpg 750w,\n/static/2f08f7bf723cf42a6a79deabc50d8b18/398d8/hero.jpg 1500w,\n/static/2f08f7bf723cf42a6a79deabc50d8b18/0e37b/hero.jpg 2250w,\n/static/2f08f7bf723cf42a6a79deabc50d8b18/29c03/hero.jpg 2546w","sizes":"(max-width: 1500px) 100vw, 1500px"}}}},"html":"<p>It's never been easier to make your home's heating smart — there's a seemingly endless number of smart thermostats available, like those from <a href=\"https://store.google.com/us/magazine/compare_thermostats?hl=en-US&#x26;GoogleNest&#x26;utm_source=nest_redirect&#x26;utm_medium=google_oo&#x26;utm_campaign=GS103056&#x26;utm_term=thermostats\">Nest</a> and <a href=\"https://www.honeywellhome.com/en/products/thermostat\">Honeywell</a>.</p>\n<p>Of course, as I outlined in my post about <a href=\"https://tommrodrigues.github.io/blog/my-dollar99-apple-smart-home\">My $99 Apple Smart Home</a>, not all of us are willing to foot the $100+ price tag that comes with many of these smart devices.</p>\n<p>This is what led me on my quest to design and build my very own smart thermostat for less than $10 using some cheap electronics and <a href=\"https://github.com/homebridge/homebridge\">Homebridge</a>.</p>\n<p>This post outlines how I achieved my goal, see <a href=\"https://github.com/Tommrodrigues/homebridge-web-boiler/tree/master/examples\">here</a> for more of a technical how-to.</p>\n<h2>OpenTherm</h2>\n<p><a href=\"https://en.wikipedia.org/wiki/OpenTherm\">OpenTherm</a> is a protocol used by many modern central heating systems to allow communication between a boiler and a thermostat.</p>\n<p>The protocol is widely used across Europe and elsewhere in the world — chances are that if you have a relatively new boiler (within the last decade or so), you'll have support for the protocol.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.8%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAxNDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjL/wgARCAANABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIDBv/EABUBAQEAAAAAAAAAAAAAAAAAAAEC/9oADAMBAAIQAxAAAAHmKVLbYP8A/8QAGhAAAgIDAAAAAAAAAAAAAAAAAQIAExIUIf/aAAgBAQABBQKws4cgu4aVdrmrkP/EABcRAQADAAAAAAAAAAAAAAAAAAABERL/2gAIAQMBAT8BpiX/xAAXEQEAAwAAAAAAAAAAAAAAAAAAARES/9oACAECAQE/Abah/8QAHRAAAgIBBQAAAAAAAAAAAAAAAAECEaESITEyUf/aAAgBAQAGPwKT9dlpicpbnJ2wXrwf/8QAGxABAAICAwAAAAAAAAAAAAAAAQARITFBsfD/2gAIAQEAAT8htPbKWYCRLIzNzBnWDeEFRbHu5//aAAwDAQACAAMAAAAQdA//xAAYEQACAwAAAAAAAAAAAAAAAAAAARExYf/aAAgBAwEBPxBPUGB//8QAFxEAAwEAAAAAAAAAAAAAAAAAAAFRYf/aAAgBAgEBPxBrTc//xAAeEAEAAgEEAwAAAAAAAAAAAAABABEhMUFxgcHh8P/aAAgBAQABPxBcdAQbrmGKDImoxiiG9lW31LEHPnzHq+HcUtGB/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image\"\n        title=\"image\"\n        src=\"/static/456c021f438104641c18bbf41d97cf5c/4edc6/radiator.jpg\"\n        srcset=\"/static/456c021f438104641c18bbf41d97cf5c/b6501/radiator.jpg 250w,\n/static/456c021f438104641c18bbf41d97cf5c/bb312/radiator.jpg 500w,\n/static/456c021f438104641c18bbf41d97cf5c/4edc6/radiator.jpg 1000w,\n/static/456c021f438104641c18bbf41d97cf5c/92dea/radiator.jpg 1500w,\n/static/456c021f438104641c18bbf41d97cf5c/cbe2c/radiator.jpg 2000w,\n/static/456c021f438104641c18bbf41d97cf5c/2e69d/radiator.jpg 2550w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>The first question is: how do you get something like a <a href=\"https://www.nodemcu.com/index_en.html\">NodeMCU</a> to talk to a boiler using the OpenTherm protocol?</p>\n<p>Well, thankfully, most of the work has already been done for us.</p>\n<p><a href=\"http://ihormelnyk.com/arduino_opentherm_controller\">This</a> blog outlines how to make an OpenTherm adapter to act as the interface between our NodeMCU, and our OpenTherm-compatible appliance.</p>\n<p>The circuit diagram is as follows:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 930px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 42%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAACmGAAAphgEi7N+MAAABhklEQVQoz01Sa2+rMAzt//9h+zJp0qp2d5QC4VVKnoQQVp7nNp4qzZJlcOzjc5wc9n1H8HVdsSwL+bZt9B+sH3rE1xh/LZyHnmCv+LLDK9l1HYZhgBscvPcQUiApEggjkJc5pJXobAelFLIsI/+Zf5AXOayzmNcZUshfQGMMOU3fN/oOjW/vb2iaBtNjQu96XNkVggvM84wkSVDrGnd+R2taGG/gB49DKI7iCMfoCK01gbreQRoJNzoqesmv6gqcc4zjiNPpRKr2bccyL3hMD0j5ZJhWKaIywr29I61Tkl9VFS7xBX70JD802d4izmLkeY40TfF5/ESrWiiraM/KPKPtcVi3FUme4OP8gSzPfhk6h67vILSAkopAlVZIixS3240Gfkff4IajrEtS0/kOWmkctNFw3iHEMCHshFUMXHA0bUOs6ltNOZYzYkfyn6BFWeCSXjDNE5Z1wTRNT8Beww4WvOWw1lLR+d+Zbi/sLACGHKsZvuIvMMaoMWMZ5YLU8DJa2RKh/9oMXI/o/WWFAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image\"\n        title=\"image\"\n        src=\"/static/a9bb262bd46cad13247d24fa4db05876/9e209/schematic.png\"\n        srcset=\"/static/a9bb262bd46cad13247d24fa4db05876/41b2e/schematic.png 250w,\n/static/a9bb262bd46cad13247d24fa4db05876/36a81/schematic.png 500w,\n/static/a9bb262bd46cad13247d24fa4db05876/9e209/schematic.png 930w\"\n        sizes=\"(max-width: 930px) 100vw, 930px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>Nothing too complicated, just some resistors, diodes, opto-couplers, and transistors.</p>\n<p>However, if you've never had experience making your own circuits, and the schematic above scares you, you might feel more comfortable buying a pre-made adaptor from the <a href=\"http://ihormelnyk.com/shop/arduino_opentherm_controller\">blog</a>.</p>\n<p>Otherwise, if you're willing to give it a shot, and would rather not spend $15 dollars on something you can make yourself for less than $10, simply buy the components listed on the blog, and solder them to some perfboard.</p>\n<p>If you want to be super fancy, I've designed a PCB <a href=\"https://github.com/Tommrodrigues/homebridge-web-boiler/tree/master/examples/OpenTherm%20PCB\">here</a> which you could send off to be made for a couple of dollars, and save yourself a lot of headache when it comes to soldering soldering the components you've ordered!</p>\n<p>Once you've got your OpenTherm adapter, we're nearly there!</p>\n<p>All that's left for hardware is something to feed in the ambient temperature to the NodeMCU. For this, I chose the DHT11 temperature sensor.</p>\n<h2>Building the thermostat</h2>\n<p>Once we've wired the sensor and the adaptor up to the NodeMCU and connected everything to the boiler, we just need to focus on the software.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.8%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAxNDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjL/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMEAf/EABUBAQEAAAAAAAAAAAAAAAAAAAMB/9oADAMBAAIQAxAAAAFiosNLyAO//8QAHBAAAgEFAQAAAAAAAAAAAAAAAQIAAwQREhMi/9oACAEBAAEFAuyZFy4TupgbQtV97z//xAAYEQADAQEAAAAAAAAAAAAAAAAAAhIBMf/aAAgBAwEBPwGVXpGH/8QAGBEAAwEBAAAAAAAAAAAAAAAAAAECEjH/2gAIAQIBAT8BVu+G2f/EAB0QAAIBBAMAAAAAAAAAAAAAAAABMgIRIZEiMXH/2gAIAQEABj8CaIOrOjtbLy9FxWSKP//EABwQAQADAAIDAAAAAAAAAAAAAAEAESExgVFxwf/aAAgBAQABPyEAF4Cp6iDR0pDck+GFsXTkd3HX6ZxHfxn/2gAMAwEAAgADAAAAEEv/AP/EABcRAAMBAAAAAAAAAAAAAAAAAAERIRD/2gAIAQMBAT8QRKSYf//EABoRAAEFAQAAAAAAAAAAAAAAAAABESExYaH/2gAIAQIBAT8QUmtPDI//xAAdEAEBAAICAwEAAAAAAAAAAAABEQAhMVFBcYHx/9oACAEBAAE/EC4TqJzoC9VHFRU0FiHHaav3Axm5AI9YajhpgOp+YlBiTTHu+Mk6724//9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image\"\n        title=\"image\"\n        src=\"/static/d6ccd69e4854447d1509d0255d93832d/4edc6/making.jpg\"\n        srcset=\"/static/d6ccd69e4854447d1509d0255d93832d/b6501/making.jpg 250w,\n/static/d6ccd69e4854447d1509d0255d93832d/bb312/making.jpg 500w,\n/static/d6ccd69e4854447d1509d0255d93832d/4edc6/making.jpg 1000w,\n/static/d6ccd69e4854447d1509d0255d93832d/92dea/making.jpg 1500w,\n/static/d6ccd69e4854447d1509d0255d93832d/cbe2c/making.jpg 2000w,\n/static/d6ccd69e4854447d1509d0255d93832d/013da/making.jpg 2549w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>The NodeMCU will use a <a href=\"https://en.wikipedia.org/wiki/PID_controller\">PID controller</a> to control the boiler's temperature based on the ambient temperature.</p>\n<p>The PID tracks changes to the ambient temperature, adjusting the boiler's output to get the ambient temperature as close to the desired temperature as possible.</p>\n<p>Simply, if it's too warm, cool down the boiler, and vice-versa.</p>\n<p>The NodeMCU manages all this for you and relays the information back to the <a href=\"https://github.com/Tommrodrigues/homebridge-web-boiler\">homebridge-web-boiler</a> plugin, so all you need to do is set the desired temperature in <a href=\"https://www.apple.com/ios/home/\">Apple HomeKit</a> — the rest will be taken care of.</p>\n<h2>Tuning</h2>\n<p>The PID controller uses some set values to work out how it should behave.</p>\n<p>For example, if your home is well insulated, it may require more even heating over a longer period of time. Another home might instead lose heat more quickly, so the controller should be more sensitive to sudden changes.</p>\n<p>The values the PID uses are: Kp, Ki, and Kd. You can look up PID controller theory if you want more information on what each of the values are responsible for — but just know that these values will vary between homes.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.8%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAxNDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjL/wgARCAANABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAwAEBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAD/9oADAMBAAIQAxAAAAEXyhSPSij/xAAbEAEBAAEFAAAAAAAAAAAAAAABAgADEiEiI//aAAgBAQABBQIrtPM7yWvPJ11wUP/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAECAQE/AUf/xAAaEAACAgMAAAAAAAAAAAAAAAAAIQEREBJB/9oACAEBAAY/AnOsDOiKrH//xAAYEAEBAQEBAAAAAAAAAAAAAAABEQAhMf/aAAgBAQABPyEngk+F7mAjuVDGizEsmT5GFdt7v//aAAwDAQACAAMAAAAQF8//xAAWEQADAAAAAAAAAAAAAAAAAAAAARH/2gAIAQMBAT8QjKz/xAAWEQEBAQAAAAAAAAAAAAAAAAAAATH/2gAIAQIBAT8QxT//xAAdEAEBAQABBQEAAAAAAAAAAAABEQAxIUFRcbHB/9oACAEBAAE/EBwwRsQMn3cXo1Dv+aE1W8PgwgjJMTqk9YzOSUcfrYEu/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image\"\n        title=\"image\"\n        src=\"/static/da430c2c8ba92ee7ffbaa3fe4523868e/4edc6/tuning.jpg\"\n        srcset=\"/static/da430c2c8ba92ee7ffbaa3fe4523868e/b6501/tuning.jpg 250w,\n/static/da430c2c8ba92ee7ffbaa3fe4523868e/bb312/tuning.jpg 500w,\n/static/da430c2c8ba92ee7ffbaa3fe4523868e/4edc6/tuning.jpg 1000w,\n/static/da430c2c8ba92ee7ffbaa3fe4523868e/92dea/tuning.jpg 1500w,\n/static/da430c2c8ba92ee7ffbaa3fe4523868e/cbe2c/tuning.jpg 2000w,\n/static/da430c2c8ba92ee7ffbaa3fe4523868e/2e69d/tuning.jpg 2550w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>A <a href=\"http://brettbeauregard.com/blog/2012/01/arduino-pid-autotune-library/\">PID auto-tuner</a> included on the NodeMCU makes finding the right values for your home easy.</p>\n<p>Once you've set your thermostat up, you should run the auto-tuner when the ambient temperature and the boiler temperature are stable.</p>\n<p>The auto-tuner will oscillate the boiler temperature very high and very low to see how the ambient temperature reacts. Note that this may take a few hours, and your home may become uncomfortably warm/cool whilst tuning is taking place</p>\n<p>From the tuning, the NodeMCU can back-calculate figures for each of the PID values for your home. These are ballpark figures, and will require finer manual tuning to optimise them.</p>\n<h2>Conclusion</h2>\n<p>Building your own smart thermostat is a relatively simple, and ultimately very rewarding task.</p>\n<p>This DIY smart thermostat was a major addition to my smart home, and my family loves being able to control and schedule the heating easily from their phones.</p>\n<p>I was also able to save more than $100, and the tuned PID controller does a far superior job maintaining a comfortable ambient temperature in my home than any of our previous thermostats have done.</p>\n<h2>Links</h2>\n<ul>\n<li><a href=\"https://github.com/Tommrodrigues/homebridge-web-boiler/tree/master/examples\">Smart Thermostat</a></li>\n<li><a href=\"https://github.com/Tommrodrigues/homebridge-web-boiler\">homebridge-web-boiler</a></li>\n<li><a href=\"http://brettbeauregard.com/blog/2012/01/arduino-pid-autotune-library/\">PID Auto-tuner Post</a></li>\n<li><a href=\"https://tommrodrigues.github.io/blog/my-dollar99-apple-smart-home\">My $99 Apple Smart Home</a></li>\n<li><a href=\"http://ihormelnyk.com/arduino_opentherm_controller\">Opentherm Adapter Post</a></li>\n<li><a href=\"https://github.com/Tommrodrigues/homebridge-web-boiler/tree/master/examples/OpenTherm%20PCB\">OpenTherm Adapter PCB</a></li>\n</ul>\n<p>P.S. Buy your parts from AliExpress, it's way cheaper than Amazon!</p>"}},"pageContext":{"slug":"my-diy-smart-thermostat"}}}